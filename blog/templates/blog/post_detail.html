{% extends "_base.html" %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Breadcrumbs navigation -->
    <div class="text-sm breadcrumbs mb-8">
        <ul>
            <li><a href="{% url 'blog:post_list' %}">Blog</a></li>
            <li class="text-base-content/70">{{ post.title|truncatechars:40 }}</li>
        </ul>
    </div>

    <article class="max-w-prose mx-auto">
        <!-- Article Header -->
        <header class="mb-8">
            <h1 class="text-4xl font-bold mb-4">{{ post.title }}</h1>
            
            <!-- Author and Publication Info -->
            <div class="flex items-center gap-4 mb-6">
                <div class="avatar">
                    <div class="w-12 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                        {% if post.author_image %}
                            <img src="{{ post.author_image }}" alt="{{ post.author}}">
                        {% else %}
                            <div class="bg-primary text-primary-content grid place-items-center">
                                {{ post.author|make_list|first }}
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="flex flex-col">
                    <span class="font-medium">{{ post.author }}</span>
                    <div class="text-sm text-base-content/70 flex flex-wrap gap-x-4">
                        <span class="flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            Published {{ post.published_date|date:"F j, Y" }}
                        </span>
                        {% if post.updated_date and post.updated_date != post.published_date %}
                            <span class="flex items-center gap-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                                Updated {{ post.updated_date|date:"F j, Y" }}
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </header>

        <!-- Featured Image -->
        
            <figure class="relative aspect-video mb-8 rounded-lg overflow-hidden">
                <img 
                    src="{% if post.image %}{{ post.image.url }}{% else %}https://res.cloudinary.com/dhhaiy58r/image/upload/v1737477297/neatnysclogo_touffj.png{% endif %}"  
                    alt="{{ post.title }}"
                    class="w-full h-full object-cover object-center"
                    loading="lazy"
                >
            </figure>
        

        <!-- Article Content -->
        <div class="prose prose-lg max-w-none mb-8">
            {{ post.content|linebreaks }}
        </div>

        <!-- Social Share -->
        {% include "blog/includes/social_share.html" %}
    </article>
    <!-- Comments Section -->
    <div class="max-w-prose mx-auto mt-12">
        <div class="divider">Comments</div>
        
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                {% if user.is_authenticated %}
                    {% csrf_token %}
                    <div id="comments-container"></div>
                {% else %}
                    <div class="alert alert-info shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <h3 class="font-bold">Join the discussion!</h3>
                            <div class="text-xs">Please <a href="{% url 'account_login' %}?next={{ request.path }}" class="link link-primary">login</a> to leave a comment.</div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <!-- Recommendations -->
    <div class="divider max-w-prose mx-auto my-12">Related Content</div>

    <div class="max-w-prose mx-auto grid gap-6 sm:grid-cols-2">
        <!-- You May Like Section -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">You May Like</h2>
                <div class="space-y-4">
                    {% for related_post in related_posts %}
                        <div class="hover:bg-base-200 p-2 rounded-lg transition-colors">
                            <a href="{{ related_post.get_absolute_url }}" 
                               class="hover:text-primary">
                                <h3 class="font-medium">{{ related_post.title }}</h3>
                                <p class="text-sm text-base-content/70">
                                    {{ related_post.published_date|date:"F j, Y" }}
                                </p>
                            </a>
                        </div>
                    {% empty %}
                        <div class="alert alert-info">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>No related posts found.</span>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Trending Section -->
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">Trending Posts</h2>
                <div class="space-y-4">
                    {% for trending_post in trending_posts %}
                        <div class="hover:bg-base-200 p-2 rounded-lg transition-colors">
                            <a href="{{ trending_post.get_absolute_url }}" 
                               class="hover:text-primary">
                                <h3 class="font-medium">{{ trending_post.title }}</h3>
                                <div class="flex items-center gap-1 text-sm text-base-content/70">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                    {{ trending_post.view_count }} views
                                </div>
                            </a>
                        </div>
                    {% empty %}
                        <div class="alert alert-info">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>No trending posts yet.</span>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{{ block.super }}
    {% if user.is_authenticated %}
        <script type="module">
            import CommentSystem from '/static/js/comments.js';
            
            // Debug info
            console.log('Template variables:', {
                contentType: '{{ content_type }}',
                objectId: '{{ object_id }}',
                postId: '{{ post.id }}'
            });
            
            // Initialize the comment system
            const comments = new CommentSystem({
                containerId: 'comments-container',
                contentType: '{{ content_type }}',
                objectId: '{{ object_id }}',
            });
        </script>
    {% endif %}
{% endblock %}