{% extends "_base.html" %}
{% block title %}Dashboard{% endblock title %}
{% block content %}
<div class="min-h-screen p-4 bg-base-200">
    <div class="container mx-auto">
        <!-- Welcome Header -->
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6">
            <div>
                <h1 class="text-3xl font-bold">Welcome back, {{ request.user.username }}!</h1>
                <p class="text-base-content/70">Manage your measurements and preferences here</p>
            </div>
            <div class="stats shadow bg-base-100">
                <div class="stat">
                    <div class="stat-title">Last Update</div>
                    <div class="stat-value text-lg">
                        {% if measurement_date %}
                            {{ measurement_date|date:"M d, Y" }}
                        {% else %}
                            No measurements
                        {% endif %}
                    </div>
                    {% if days_since_update %}
                        <div class="stat-desc">{{ days_since_update }} days ago</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column (Takes 2 columns on large screens) -->
            <div class="lg:col-span-2 space-y-6">
                {% if has_measurements %}
                    {% if needs_update %}
                        <div class="alert alert-warning shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <div>
                                <h3 class="font-bold">Time for a Measurement Update!</h3>
                                <div class="text-sm">Keep your measurements current for the perfect fit.</div>
                            </div>
                        </div>
                    {% endif %}

                    <!-- Measurement Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Upper Body Card -->
                        <div class="card bg-base-100 shadow-xl">
                            <div class="card-body">
                                <h2 class="card-title text-primary">Upper Body</h2>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Chest</span>
                                        <span class="font-medium">
                                            {% if measurement.chest %}{{ measurement.chest }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Shoulder</span>
                                        <span class="font-medium">
                                            {% if measurement.shoulder %}{{ measurement.shoulder }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Neck</span>
                                        <span class="font-medium">
                                            {% if measurement.neck %}{{ measurement.neck }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Sleeve Length</span>
                                        <span class="font-medium">
                                            {% if measurement.sleeve_length %}{{ measurement.sleeve_length }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Sleeve Round</span>
                                        <span class="font-medium">
                                            {% if measurement.sleeve_round %}{{ measurement.sleeve_round }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Top Length</span>
                                        <span class="font-medium">
                                            {% if measurement.top_length %}{{ measurement.top_length }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Lower Body Card -->
                        <div class="card bg-base-100 shadow-xl">
                            <div class="card-body">
                                <h2 class="card-title text-primary">Lower Body</h2>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Waist</span>
                                        <span class="font-medium">
                                            {% if measurement.waist %}{{ measurement.waist }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Thigh</span>
                                        <span class="font-medium">
                                            {% if measurement.thigh %}{{ measurement.thigh }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Knee</span>
                                        <span class="font-medium">
                                            {% if measurement.knee %}{{ measurement.knee }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Ankle</span>
                                        <span class="font-medium">
                                            {% if measurement.ankle %}{{ measurement.ankle }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Hips</span>
                                        <span class="font-medium">
                                            {% if measurement.hips %}{{ measurement.hips }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-base-content/70">Trouser Length</span>
                                        <span class="font-medium">
                                            {% if measurement.trouser_length %}{{ measurement.trouser_length }}"{% else %}Not set{% endif %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Update Button -->
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body flex flex-row justify-between items-center">
                            <div>
                                <h3 class="font-bold">Update Your Measurements</h3>
                                <p class="text-sm text-base-content/70">Keep your measurements current for the best fit</p>
                            </div>
                            <a href="{% url 'measurement:update_measurement' measurement.id %}" class="btn btn-primary">Update Now</a>
                        </div>
                    </div>
                {% else %}
                    <!-- No Measurements State -->
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body text-center">
                            <div class="flex flex-col items-center gap-4">
                                <a href="{% url 'measurement:create_measurement' %}" class="btn btn-primary btn-wide">Add Your Measurements</a>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- Recent Orders Preview -->
                {% if order %}
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="card-title">Recent Orders</h2>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="table table-zebra">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for orders in order|slice:":5" %}
                                        <tr>
                                            <td>{{ orders.id|stringformat:".8s" }}...</td>
                                            <td>{{ orders.created|date:"Y-m-d" }}</td>
                                            {% if orders.paid %}
                                            <td><span class="badge badge-success">Paid</span></td>
                                            {% else %}
                                            <td><span class="badge">Pending</span></td>
                                            {% endif %}
                                            <td>N{{ orders.total_cost }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="card bg-base-100 shadow-xl">
                        <div class="card-body">
                            <div class="flex flex-col items-center justify-center py-12">
                                <div class="text-center">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                    </svg>
                                    <h3 class="mt-2 text-sm font-medium text-gray-900">No Orders</h3>
                                    <p class="mt-1 text-sm text-gray-500">No Orders found in your history.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Right Sidebar -->
            <div class="space-y-6">
                <!-- Profile Summary -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="avatar placeholder">
                                <div class="bg-neutral text-neutral-content rounded-full w-12">
                                    <span>{{ request.user.username|make_list|first|upper }}</span>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-bold">{{ request.user.username }}</h3>
                                <p class="text-sm text-base-content/70">Member since {{ request.user.date_joined|date:"M Y" }}</p>
                            </div>
                        </div>
                        <progress class="progress progress-primary" value="100" max="100"></progress>
                        <p class="text-sm text-center text-base-content/70">Profile completion: 100%</p>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title mb-4">Quick Actions</h2>
                        <div class="space-y-2">
                            <a href="{% url 'products:product_list' %}" class="btn btn-outline btn-block">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                                </svg>
                                Continue Shopping
                            </a>
                            <a href="{% url 'cart:cart_detail' %}" class="btn btn-outline btn-block">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                View Orders
                            </a>
                            <a href="{% url 'pages:contact' %}" class="btn btn-outline btn-block">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Get Help
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Measurement Tips -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title mb-4">Measurement Tips</h2>
                        <div class="space-y-4">
                            <div class="flex gap-3 items-start">
                                <div class="bg-base-200 p-2 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="font-medium">Use a Fabric Tape</h4>
                                    <p class="text-sm text-base-content/70">Always use a flexible fabric measuring tape for accuracy</p>
                                </div>
                            </div>
                            <div class="flex gap-3 items-start">
                                <div class="bg-base-200 p-2 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="font-medium">Stand Naturally</h4>
                                    <p class="text-sm text-base-content/70">Maintain a relaxed posture while measuring</p>
                                </div>
                            </div>
                            <div class="flex gap-3 items-start">
                                <div class="bg-base-200 p-2 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="font-medium">Regular Updates</h4>
                                    <p class="text-sm text-base-content/70">Update measurements every 3 months</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Feed -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title mb-4">Recent Activity</h2>
                        <div class="space-y-4">
                            {% if measurement_date %}
                                <div class="flex items-center gap-4">
                                    <div class="avatar placeholder">
                                        <div class="bg-primary text-primary-content rounded-full w-8">
                                            <span class="text-xs">M</span>
                                        </div>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium">Measurements Updated</p>
                                        <p class="text-xs text-base-content/70">{{ measurement_date|date:"M d, Y" }}</p>
                                    </div>
                                </div>
                            {% endif %}
                            {% for orders in order|slice:":1" %}
                            <div class="flex items-center gap-4">
                                <div class="avatar placeholder">
                                    <div class="bg-secondary text-secondary-content rounded-full w-8">
                                        <span class="text-xs">O</span>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-sm font-medium">{{ orders.id|stringformat:".8s" }}...</p>
                                    <p class="text-xs text-base-content/70">{{orders.created|date:"Y-m-d"}}</p>
                                </div>
                            </div>
                            {% endfor %}
                            <div class="flex items-center gap-4">
                                <div class="avatar placeholder">
                                    <div class="bg-accent text-accent-content rounded-full w-8">
                                        <span class="text-xs">P</span>
                                    </div>
                                </div>
                                <div>
                                    <p class="text-sm font-medium">Profile Created</p>
                                    <p class="text-xs text-base-content/70">{{ request.user.date_joined|date:"M d, Y" }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Help & Support -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title mb-4">Need Help?</h2>
                        <div class="space-y-3">
                            <button onclick="measurement_modal.showModal()" class="flex items-center gap-2 text-sm hover:text-primary transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Measurement Guide
                            </button>

                            <a href="{% url 'pages:contact' %}" class="flex items-center gap-2 text-sm hover:text-primary transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                                Contact Support
                            </a>

                            <button onclick="size_modal.showModal()" class="flex items-center gap-2 text-sm hover:text-primary transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                                Size Guide
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Measurement Guide Modal -->
<dialog id="measurement_modal" class="modal modal-bottom sm:modal-middle">
    <div class="modal-box">
        <h3 class="text-lg font-bold">How to Measure Yourself Correctly</h3>
        <div class="py-4 space-y-4">
            <div class="space-y-2">
                <h4 class="font-semibold">What You'll Need:</h4>
                <ul class="list-disc ml-5 text-sm">
                    <li>Flexible measuring tape</li>
                    <li>Well-lit room with a mirror</li>
                    <li>Fitted undergarments</li>
                </ul>
            </div>
            <div class="space-y-2">
                <h4 class="font-semibold">Key Measurements:</h4>
                <ul class="list-disc ml-5 text-sm">
                    <li><span class="font-medium">Chest/Bust:</span> Measure around the fullest part, keeping the tape parallel to the floor</li>
                    <li><span class="font-medium">Waist:</span> Measure around your natural waistline, smallest part of the waist</li>
                    <li><span class="font-medium">Hips:</span> Measure around the fullest part of your hips</li>
                    <li><span class="font-medium">Inseam:</span> Measure from the crotch to where you want the hem to fall</li>
                </ul>
            </div>
            <p class="text-sm text-base-content/80">For the most accurate results, stand straight and breathe normally while measuring. Don't pull the tape too tight.</p>
        </div>
        <div class="modal-action">
            <form method="dialog">
                <button class="btn">Close</button>
            </form>
        </div>
    </div>
</dialog>

<!-- Size Guide Modal -->
<dialog id="size_modal" class="modal modal-bottom sm:modal-middle">
    <div class="modal-box">
        <h3 class="text-lg font-bold">Size Guide</h3>
        <div class="py-4 space-y-4">
            <div class="overflow-x-auto">
                <table class="table table-xs">
                    <thead>
                        <tr>
                            <th>Size</th>
                            <th>Chest (in)</th>
                            <th>Waist (in)</th>
                            <th>Hips (in)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>XS</td>
                            <td>32-34</td>
                            <td>26-28</td>
                            <td>35-37</td>
                        </tr>
                        <tr>
                            <td>S</td>
                            <td>34-36</td>
                            <td>28-30</td>
                            <td>37-39</td>
                        </tr>
                        <tr>
                            <td>M</td>
                            <td>36-38</td>
                            <td>30-32</td>
                            <td>39-41</td>
                        </tr>
                        <tr>
                            <td>L</td>
                            <td>38-40</td>
                            <td>32-34</td>
                            <td>41-43</td>
                        </tr>
                        <tr>
                            <td>XL</td>
                            <td>40-42</td>
                            <td>34-36</td>
                            <td>43-45</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="space-y-2">
                <h4 class="font-semibold">Fit Tips:</h4>
                <ul class="list-disc ml-5 text-sm">
                    <li>If you're between sizes, we recommend sizing up for a more comfortable fit</li>
                    <li>Our garments are designed with a regular fit, not too tight or loose</li>
                    <li>Check the product description for specific fit recommendations</li>
                </ul>
            </div>
        </div>
        <div class="modal-action">
            <form method="dialog">
                <button class="btn">Close</button>
            </form>
        </div>
    </div>
</dialog>
{% endblock content %}